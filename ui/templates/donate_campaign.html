<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donate to Campaign - HEAL CHAIN</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.3.6/dist/web3.min.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</head>
<body>
    <header class="header">
        <div class="container">
            <h1 class="heading">HEAL CHAIN.</h1>
            <nav class="navbar">
                <ul class="navbar-list">
                    
                    <li class="navbar-item">
                        <a href="{{ url_for('index') }}" class="navbar-link">Home</a>
                    </li>
                    <li class="navbar-item">
                        <a href="{{ url_for('view_campaign') }}" class="navbar-link">View Campaign</a>
                    </li>
                    <li class="navbar-item">
                        <a href="{{ url_for('donate_campaign') }}" class="navbar-link">Donate to Campaign</a>
                    </li>
                    <li class="navbar-item">
                        <a href="{{ url_for('create_user') }}" class="navbar-link">User</a>
                    </li>
                    
                   
                </ul>
                <a href="index.html?create=true" class="btn">Create Campaign</a>
                <button id="connectWalletButton" class="btn">Connect Wallet</button>
            </nav>
        </div>
    </header>

    <section id="donateCampaign">
        <h2>Donate to Campaign</h2>
        <div class="donate-form">
            <label for="campaignId">Campaign ID:</label>
            <input type="number" id="campaignId" placeholder="Enter Campaign ID" required>

            <label for="donationAmount">Donation Amount (ETH):</label>
            <input type="number" id="donationAmount" placeholder="Enter Amount" step="0.01" required>

            <button id="donateButton" class="btn">Donate</button>
        </div>
    </section>

    <script>
        // Function to handle donation
        async function donateToCampaign() {
            const campaignId = document.getElementById('campaignId').value;
            const donationAmount = document.getElementById('donationAmount').value;

            if (!campaignId || !donationAmount) {
                alert("Please enter a valid Campaign ID and Donation Amount.");
                return;
            }

            try {
                // Convert donation amount to wei
                const amountInWei = web3.utils.toWei(donationAmount, 'ether');

                // Call the donateCampaign function in the smart contract
                await contractInstance.methods.donateCampaign(campaignId).send({
                    from: web3.eth.defaultAccount,
                    value: amountInWei
                });

                alert("Donation successful! Thank you for your contribution.");
                window.location.href = "index.html"; // Redirect to home page after donation
            } catch (error) {
                console.error("Error donating to campaign:", error);
                alert("Failed to donate. Please check the console for details.");
            }
        }

        // Add event listener to the donate button
        document.getElementById('donateButton').addEventListener('click', donateToCampaign);

        // Initialize Web3 and contract
        document.addEventListener('DOMContentLoaded', async () => {
            await initWeb3();
        });
    </script>
</body>
</html>